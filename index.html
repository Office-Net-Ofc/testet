<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Confirma√ß√£o de Presen√ßa - Pedro D√¥mini</title>

<style>
  :root{
    --verde:#2f7d32;
    --verde2:#256428;
    --bg:#f7f2e8;
    --texto:#4e342e;
  }

  body{
    font-family: "Segoe UI", Arial, sans-serif;
    background: var(--bg);
    min-height: 100vh;
    margin: 0;
    overflow-x: hidden;
  }

  .container{
    position: relative;
    z-index: 2;
    background: #fff;
    padding: 30px;
    border-radius: 18px;
    max-width: 440px;
    margin: 40px auto;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    border: 4px solid var(--verde);
  }

  .header-img{
    width: 100%;
    max-width: 340px;
    display: block;
    margin: 0 auto 20px;
  }

  h2{ text-align:center; color: var(--verde); margin: 0 0 10px; }

  label{
    font-weight: 600;
    margin-top: 18px;
    display: block;
    color: var(--texto);
  }

  input, textarea, select{
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #cfcfcf;
    font-size: 15px;
    box-sizing: border-box;
  }

  textarea{ resize: vertical; min-height: 88px; }

  button{
    margin-top: 25px;
    width: 100%;
    padding: 15px;
    background-color: var(--verde);
    color: #fff;
    font-size: 17px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  button:hover{ background-color: var(--verde2); }
  button:disabled{ opacity: .6; cursor: not-allowed; }

  #loading{
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.96);
    z-index: 9999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
  }

  #result{
    display: none;
    margin-top: 14px;
    padding: 12px;
    border-radius: 10px;
    font-weight: 600;
    line-height: 1.35;
    word-break: break-word;
  }
  #result.ok{
    background:#e8f5e9;
    color:#1b5e20;
    border:1px solid #c8e6c9;
  }
  #result.err{
    background:#ffebee;
    color:#b71c1c;
    border:1px solid #ffcdd2;
  }
</style>
</head>

<body>

<div id="loading">
  <h2>‚è≥ Aguarde</h2>
  <p>Enviando sua confirma√ß√£o üíö</p>
</div>

<div class="container">
  <img
    src="https://office-net-ofc.github.io/confirmacao-de-presenca/imagens/aergergerg.PNG"
    class="header-img"
    alt="Convite"
  />

  <h2>üåø Confirma√ß√£o de Presen√ßa</h2>

  <label for="nome">Qual √© o seu nome?</label>
  <input type="text" id="nome" placeholder="Digite seu nome completo" autocomplete="name" />

  <label for="quantidade">Quantas pessoas contando com voc√™ ir√£o?</label>
  <select id="quantidade">
    <option value="">Qtd</option>
    <option value="1">1</option><option value="2">2</option><option value="3">3</option>
    <option value="4">4</option><option value="5">5</option><option value="6">6</option>
  </select>

  <label for="pessoas">Quem ir√° com voc√™?
  informe o nome completo dos seus acompanhates e idade em caso de crian√ßas.</label>
  <textarea id="pessoas" placeholder="Ex: Maria Silva, Jo√£o Silva (5 anos)"></textarea>

  <label for="status">Confirma presen√ßa?</label>
  <select id="status">
    <option value="Confirmado">‚úÖ Sim</option>
    <option value="N√£o poder√° comparecer">‚ùå N√£o</option>
  </select>

  <button id="btnEnviar" type="button">Enviar confirma√ß√£o üíö</button>

  <div id="result"></div>
</div>

<script>
  const nome = document.getElementById("nome");
  const quantidade = document.getElementById("quantidade");
  const pessoas = document.getElementById("pessoas");
  const status = document.getElementById("status");
  const btnEnviar = document.getElementById("btnEnviar");
  const loading = document.getElementById("loading");
  const result = document.getElementById("result");

  function showResult(ok, text) {
    result.className = ok ? "ok" : "err";
    result.textContent = text;
    result.style.display = "block";
  }

  function setBusy(isBusy) {
    btnEnviar.disabled = isBusy;
    loading.style.display = isBusy ? "flex" : "none";
  }

  btnEnviar.addEventListener("click", () => {
    const n = (nome.value || "").trim();
    const q = (quantidade.value || "").trim();
    const p = (pessoas.value || "").trim();
    const s = (status.value || "").trim();

    if (!n || !q) {
      alert("Preencha nome e quantidade.");
      return;
    }

    result.style.display = "none";
    setBusy(true);

    // Timeout pra nunca travar infinito
    const timeoutMs = 12000;
    const t = setTimeout(() => {
      setBusy(false);
      showResult(false, "Travou ao comunicar com o servidor. Prov√°vel: p√°gina n√£o est√° rodando no Web App do Apps Script ou implanta√ß√£o desatualizada.");
    }, timeoutMs);

    // Se n√£o estiver dentro do Web App, isso d√° o erro real (e voc√™ v√™ na tela)
    try {
      if (!window.google || !google.script || !google.script.run) {
        clearTimeout(t);
        setBusy(false);
        showResult(false, "Erro: esta p√°gina n√£o est√° rodando dentro do Web App do Apps Script (google.script.run indispon√≠vel). Abra pelo link /exec do Apps Script.");
        return;
      }

      const payload = { nome: n, quantidade: q, pessoas: p, status: s, origem: "webapp" };

      google.script.run
        .withSuccessHandler((resp) => {
          clearTimeout(t);
          setBusy(false);

          if (!resp || !resp.ok) {
            showResult(false, resp?.error || "Falha ao registrar/enviar.");
            console.log("Detalhes WA:", resp?.wa || null);
            return;
          }

          showResult(true, "Confirma√ß√£o registrada e enviada ‚úÖ");
          console.log("WA OK:", resp.wa);
        })
        .withFailureHandler((err) => {
          clearTimeout(t);
          setBusy(false);
          showResult(false, "Erro no Apps Script: " + (err?.message || String(err)));
          console.error(err);
        })
        .confirmarPresenca(payload);

    } catch (e) {
      clearTimeout(t);
      setBusy(false);
      showResult(false, "Erro no navegador: " + (e?.message || String(e)));
      console.error(e);
    }
  });
</script>

</body>
</html>
