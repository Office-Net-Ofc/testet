<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Confirma√ß√£o de Presen√ßa - Pedro D√¥mini</title>

<style>
  :root{
    --verde:#2f7d32;
    --verde2:#256428;
    --bg:#f7f2e8;
    --texto:#4e342e;
  }

  body{
    font-family: "Segoe UI", Arial, sans-serif;
    background: var(--bg);
    min-height: 100vh;
    margin: 0;
    overflow-x: hidden;
  }

  /* Folhas caindo */
  .folhas{
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
  }

  .folha{
    position: absolute;
    top: -80px;
    opacity: .75;
    will-change: transform;
    animation-name: cair;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,.12));
  }

  @keyframes cair{
    0%   { transform: translate3d(var(--x,0), -80px, 0) rotate(0deg); }
    100% { transform: translate3d(var(--x,0), 110vh, 0) rotate(360deg); }
  }

  .container{
    position: relative;
    z-index: 2;
    background: #fff;
    padding: 30px;
    border-radius: 18px;
    max-width: 440px;
    margin: 40px auto;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    border: 4px solid var(--verde);
  }

  .header-img{
    width: 100%;
    max-width: 340px;
    display: block;
    margin: 0 auto 20px;
  }

  h2{ text-align:center; color: var(--verde); margin: 0 0 10px; }

  label{
    font-weight: 600;
    margin-top: 18px;
    display: block;
    color: var(--texto);
  }

  input, textarea, select{
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #cfcfcf;
    font-size: 15px;
    box-sizing: border-box;
  }

  textarea{ resize: vertical; min-height: 88px; }

  button{
    margin-top: 25px;
    width: 100%;
    padding: 15px;
    background-color: var(--verde);
    color: #fff;
    font-size: 17px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  button:hover{ background-color: var(--verde2); }
  button:disabled{ opacity: .6; cursor: not-allowed; }

  /* LOADING (corrigido: come√ßa escondido e s√≥ aparece via JS) */
  #loading{
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.96);
    z-index: 9999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
  }

  /* FALLBACK */
  #waFallback{
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.98);
    z-index: 99999;
    padding: 20px;
  }
  #waFallback .card{
    max-width: 520px;
    margin: 40px auto;
    background: #fff;
    border-radius: 16px;
    padding: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,.12);
  }
  #waFallback textarea{
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #cfcfcf;
    box-sizing: border-box;
  }
  #waFallback .row{
    display: flex;
    gap: 10px;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  #waFallback .btn{
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    font-size: 15px;
  }
  #waFallback .btn-primary{ background: var(--verde); color: #fff; }
  #waFallback .btn-outline{ background: #fff; border: 1px solid #ccc; color: #222; }
</style>
</head>

<body>

<div id="loading">
  <h2>‚è≥ Aguarde</h2>
  <p>Registrando sua confirma√ß√£o üíö</p>
</div>

<div id="waFallback">
  <div class="card">
    <h3>Quase l√° ‚úÖ</h3>
    <p>Se o WhatsApp n√£o abriu automaticamente, use uma das op√ß√µes abaixo:</p>
    <textarea id="waMsg" rows="7" readonly></textarea>
    <div class="row">
      <a id="btnOpenWa" class="btn btn-primary" href="#" target="_blank" rel="noopener">Abrir WhatsApp</a>
      <button id="btnCopyWa" class="btn btn-outline" type="button">Copiar mensagem</button>
    </div>
  </div>
</div>

<div class="folhas" id="folhas" aria-hidden="true"></div>

<div class="container">
  <img
    src="https://office-net-ofc.github.io/confirmacao-de-presenca/imagens/aergergerg.PNG"
    class="header-img"
    alt="Convite"
  />

  <h2>üåø Confirma√ß√£o de Presen√ßa</h2>

  <label for="nome">Qual √© o seu nome?</label>
  <input type="text" id="nome" placeholder="Digite seu nome completo" autocomplete="name" />

  <label for="quantidade">Quantas pessoas contando com voc√™ ir√£o?</label>
  <select id="quantidade">
    <option value="">Qtd</option>
    <option value="1">1</option><option value="2">2</option><option value="3">3</option>
    <option value="4">4</option><option value="5">5</option><option value="6">6</option>
  </select>

  <label for="pessoas">Quem ir√° com voc√™?
  informe o nome completo dos seus acompanhates e idade em caso de crian√ßas.</label>
  <textarea id="pessoas" placeholder="Ex: Maria Silva, Jo√£o Silva (5 anos)"></textarea>

  <label for="status">Confirma presen√ßa?</label>
  <select id="status">
    <option value="Confirmado">‚úÖ Sim</option>
    <option value="N√£o poder√° comparecer">‚ùå N√£o</option>
  </select>

  <button id="btnEnviar" type="button">Enviar confirma√ß√£o üíö</button>
</div>

<script>
  // ====== CONFIG ======
  const LEAF_IMG = "https://office-net-ofc.github.io/confirmacao-de-presenca/imagens/Moldes_De_Folhas_Para_Imprimir_-_Dicas_Pr%C3%A1ticas__ABB-removebg-preview.png";

  // N√∫mero destino (Brasil +55) -> 98989117646
  const WHATSAPP_PHONE = "5598989117646";

  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzJiVAymgiZuoWMaq1-U8ZD1n6m7cdF841LP8aYmB0LysRNbZfmbOPvKlnNftgiG30hfQ/exec";

  // ====== ELEMENTOS ======
  const nome = document.getElementById("nome");
  const quantidade = document.getElementById("quantidade");
  const pessoas = document.getElementById("pessoas");
  const status = document.getElementById("status");
  const btnEnviar = document.getElementById("btnEnviar");

  const loading = document.getElementById("loading");
  const waFallback = document.getElementById("waFallback");
  const waMsg = document.getElementById("waMsg");
  const btnOpenWa = document.getElementById("btnOpenWa");
  const btnCopyWa = document.getElementById("btnCopyWa");

  // ====== FOLHAS CAINDO (em volta do formul√°rio) ======
  function gerarLeftEmVoltaDoCentro() {
    // Evita cair no ‚Äúmiolo‚Äù do formul√°rio (aprox 30%..70% da largura)
    let left = Math.random() * 100;
    if (left > 30 && left < 70) {
      // joga pra borda esquerda ou direita
      left = (Math.random() < 0.5)
        ? (Math.random() * 22)            // 0..22
        : (78 + Math.random() * 22);      // 78..100
    }
    return left;
  }

  function criarFolhas(qtd = 34) {
    const wrap = document.getElementById("folhas");
    wrap.innerHTML = "";

    for (let i = 0; i < qtd; i++) {
      const img = document.createElement("img");
      img.src = LEAF_IMG;
      img.className = "folha";
      img.alt = "";
      img.decoding = "async";
      img.loading = "eager"; // garante que apare√ßa r√°pido

      const size = 18 + Math.random() * 34; // 18..52
      img.style.width = size + "px";

      img.style.left = gerarLeftEmVoltaDoCentro() + "%";

      const drift = (Math.random() * 140 - 70).toFixed(0) + "px";
      img.style.setProperty("--x", drift);

      const duration = 6 + Math.random() * 10; // 6..16
      const delay = -(Math.random() * duration);
      img.style.animationDuration = duration + "s";
      img.style.animationDelay = delay + "s";

      img.style.transform = `translateY(-80px) rotate(${Math.random() * 360}deg)`;
      wrap.appendChild(img);
    }
  }

  criarFolhas(34);
  window.addEventListener("resize", () => criarFolhas(34));

  // ====== WHATSAPP FALLBACK ======
  function mostrarFallback(mensagem, link) {
    waMsg.value = mensagem;
    btnOpenWa.href = link;

    btnCopyWa.innerText = "Copiar mensagem";
    btnCopyWa.onclick = async () => {
      try {
        await navigator.clipboard.writeText(mensagem);
        btnCopyWa.innerText = "Copiado ‚úÖ";
      } catch {
        alert("N√£o foi poss√≠vel copiar automaticamente. Selecione e copie manualmente.");
      }
    };

    waFallback.style.display = "block";
  }

  function abrirWhatsAppComFallback(mensagem) {
    const text = encodeURIComponent(mensagem);
    const waLink = `https://wa.me/${WHATSAPP_PHONE}?text=${text}`;

    window.location.href = waLink;

    setTimeout(() => {
      mostrarFallback(mensagem, waLink);
    }, 1200);
  }

  // ====== ENVIO ======
  btnEnviar.addEventListener("click", async () => {
    const n = (nome.value || "").trim();
    const q = (quantidade.value || "").trim();
    const p = (pessoas.value || "").trim();
    const s = (status.value || "").trim();

    if (!n || !q) {
      alert("Preencha nome e quantidade.");
      return;
    }

    btnEnviar.disabled = true;
    loading.style.display = "flex";

    const mensagem =
`üåø *CONFIRMA√á√ÉO DE PRESEN√áA* üåø
üéâ Anivers√°rio de 1 ano do Pedro D√¥mini

üë§ Nome: ${n}
üë• Quantidade: ${q}
üë®‚Äçüë©‚Äçüëß Pessoas: ${p || "N√£o informado"}
üìå Status: ${s || "Confirmado"}`;

    try {
      const formData = new FormData();
      formData.append("nome", n);
      formData.append("quantidade", q);
      formData.append("pessoas", p);
      formData.append("status", s);

      const resp = await fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        body: formData
      });

      if (!resp.ok) {
        console.warn("Google Script respondeu com status:", resp.status);
      }
    } catch (err) {
      console.warn("Falha ao enviar para Google Script:", err);
      // n√£o trava: ainda vai pro WhatsApp
    } finally {
      loading.style.display = "none";
      btnEnviar.disabled = false;
      abrirWhatsAppComFallback(mensagem);
    }
  });
</script>

</body>
</html>
